<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="../../style.css">

    <title>Mushpunk - Cibersec</title>
</head>
<body>
    <ul class="nav justify-content-center">
        <li class="nav-item">
            <a class="nav-link" href="./../../index.html">cd /root</a>
        </li>
    </ul>

    <div class="contents">
        <h2>Walkthrough: Basic Pentest TryHackme [PT/BR]</h2>
        <img src="./header.png" class="image-header">

        <p>E aí turma, beleza? Hoje venho compartilhar com vocês o “Walkthrough” da máquina Basic Pentest do TryHackMe. A máquina é free, não é necessário ser assinante, então cola aí e vamos nessa! 
        <br><br>Após iniciarmos a máquina, precisamos fazer um breve reconhecimento do nosso alvo. Vou começar executando o nmap pra varrer as portas atrás de serviços em execução</p>

        <b>nmap -sS -T4 -v 10.10.251.1</b>

        <img src="./1.png" class="image-writeup">

        <p>O nmap nos indicou que temos alguns serviços executando nessa máquina, os mais relevantes pra nós são: 22/SSH, 80/HTTP, 445/SMB<br><br>Quando acessamos a página web que está em execução na porta 80 temos uma página que nos informa que o site está em manutenção</p>

        <img src="./2.png" class="image-writeup">

        <p>Aparentemente nessa primeira página não temos nada, mas dando uma olhada no código fonte da aplicação percebemos que tem uma nota para os desenvolvedores pedindo para que eles olhem a “seção de notas”</p>

        <img src="./3.png" class="image-writeup">

        <p>Sabendo que temos uma seção de notas para serem olhadas, vamos realizar um brute force nos diretórios do site em busca dessas notas.</p>

        <b>gobuster dir -u 10.10.251.1:80 -t 16 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</b>

        <img src="./4.png" class="image-writeup">

        <p>Bingo! Encontramos o diretório /development</p>

        <b>Question: What is the name of the hidden directory on the web server(enter name without /)? — R: development</b><br><br>

        <p>Acessando-o encontramos dois arquivos .txt</p>

        <img src="./5.png" class="image-writeup">

        <p>Um desses arquivos (dev.txt) nos diz que o smb foi configurado, até aqui nada de muito relevante, já sabemos que tem um arquivo smb executando nesse ip.<br><br>No segundo arquivo (j.txt) temos a seguinte mensagem:</p>

        <pre>
For J:
    I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
    and I was able to crack your hash really easily. You know our password policy, so please follow
    it? Change that password ASAP.
-K
        </pre>

        <p>Esse arquivo nos diz que a uma das senhas do arquivo /etc/shadow foi facilmente quebrada. O início do arquivo nos diz que esse ele é para alguém chamado “J”</p>
        <p>Bom, as informações que temos até aqui é que alguém conhecido como “J” tem uma senha fraca e que pode ser facilmente quebrada.</p>
        <p>Precisamos continuar nosso processo de reconhecimento e enumeração para encontrarmos mais informações sobre essa “J”</p>
        <p>Ainda não demos uma olhada no SMB desse servidor, vamos testa-lo! Aqui usarei o enum4linux para recolher o máximo de informações possíveis</p>

        <b>enum4linux 10.10.251.1 -a</b><br><br>
        <p>Como a saída do comando enum4linux é muito grande, permita-me abstrair e informar que uma das coisas mais importantes que encontramos foi um compartilhamento chamado de “anonymous”. Ok particularmente é bem legal, a próxima coisa a ser feita é tentar acessa-lo através de um usuário anonimo através do comando:</p>
        <b>smbclient //10.10.251.1/anonymous -U anonymous</b><br><br>
        <p>Bingo! Conseguimos acesso. Ao listar os arquivos dessa pasta temos o arquivo staff.txt</p>

        <img src="./6.png" class="image-writeup">

        <p>Aqui, encontramos dois nicks (Jan e Kay) lembram dos arquivos que encontramos no /development? Lá tinham as letras J e K, que podemos assumir que são reduções do nick Jan e Kay.</p>
        <b>Question: What is the username? — R: Jan</b><br><br>
        <p>Legal! Em um dos arquivos que lemos lá dizia que a senha de “J” ou “Jan” estava fraca e poderia ser facilmente quebrada. Vamos tentar?</p>
        <p>Aqui eu vou tentar acessar o serviço SSH com a credential da Jan, como não temos a senha vai ser preciso realizar um brute force com o hydra</p>
        <b>hydra -l jan -P /usr/share/wordlists/rockyou.txt -t 16 10.10.251.1 ssh</b>

        <img src="./7.png" class="image-writeup">

        <b>Question: What is the password? — R: armando</b><br><br>
        <b>Question: What service do you use to access the server(answer in abbreviation in all caps)? — R: SSH</b><br><br>

        <p>Agora que temos o login e a senha da Jan, vamos logar na máquina alvo via SSH</p>
        <p>Dando uma navegada na máquina, descobrimos que dentro da /home temos a pasta de outro usuário chamado “kay”</p>

        <b>Question: What is the name of the other user you found(all lower case)? — R: kay</b><br><br>

        <p>Dentro da pasta da kay temos o arquivo pass.bak que infelizmente não temos permissão de leitura. Executando o comando “sudo -l” para encontrar algum binário que pode ser executado como sudo por nós, também não temos sucesso.</p>
        <p>Precisamos encontrar alguma forma de acessar a máquina como a usuário kay.</p>
        <p>Dentro da pasta da kay temos a pasta .ssh, que tal darmos uma olhada lá?</p>

        <img src="./8.png" class="image-writeup">
        
        <p>Bingo, aqui temos alguns arquivos que podem ser muito útil para nós. Como na máquina que estamos logado via ssh não temos as ferramentas do Kali disponível, precisamos dar um jeito de termos esses arquivos na nossa máquina.</p>
        <p>A solução que eu encontrei pra isso foi executar um servidor python na máquina alvo através do comando</p>

        <b>python -m SimpleHTTPServer 9001</b><br><br>

        <p>O que vai me dar a possibilidade de baixar esses arquivos diretamente da minha máquina. Eu vou baixar apenas o arquivo id_rsa, que é a chave privada da kay para acesso via ssh</p>

        <img src="./9.png" class="image-writeup">

        <p>Após baixada a id_rsa, o que precisamos fazer é alterar a permisão para 600 através do comando</p>
        
        <b>sudo chmod 600 id_rsa</b>

        <p>Feito isso tentaremos acessar o ssh passando a id_rsa.pub como "senha" através do parâmetro -i</p>
        <p>Infelizmente sem sucesso porque mesmo com a chave pública precisamos fornecer uma senha.</p>

        <img src="./10.png" class="image-writeup">

        <p>Por sorte temos o john, na verdade uma versão dele que é o ssh2john que permite quebrar hashes de SSH.</p>
        <p>Primeiro precisamos gerar um hash da senha, faremos isso com o ssh2john, que é uma “variante” do john para trabalhar com hashes de SSH.</p>
        <p>Feito isso utilizaremos o próprio john para quebrar o hash gerado pelo ssh2john</p>

        <b>ssh2john id_rsa > id_rsa.hash</b><br>
        <b>john id_rsa.hash <wordlist></b><br><br>

        <p>E voilà, encontramos a senha do hash</p>

        <img src="./11.png" class="image-writeup">

        <p>Agora tentando conectar via SSH com as credenciais da kay passando a id_rsa como parâmetro através do -i e fornecendo “beeswax” como passphrase conseguimos logar na máquina como kay e ler o arquivo pass.bak</p>

        <img src="./12.png" class="image-writeup">

        <b>Question: What is the final password you obtain? — R: heresareallystrongpasswordthatfollowsthepasswordpolicy$$</b>


    </div>



    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/7dc0d5b6d6.js" crossorigin="anonymous"></script>
</body>
</html>